"use strict";import{a as t,br as U,button as r,checkbox as q,div as u,doomHelperDebug as P,footer as B,form as F,h1 as c,h2 as d,h3 as o,img as n,input as g,li as m,mountableStylesheet as M,nav as K,p as O,QueryRouter as R,RouterLazyLoad as s,ShowIf as l,Signal as i,span as p,svg as e,text as w,TextState as a,ul as f}from"./domHelper.min.js";import{metaSet as z,metaType as J}from"./../lib/metaTag.js";import{fetchApi as h,isLocalNetwork as $,isMobile as Q}from"./../lib/lib.js";import{UserGuideTool as Y}from"./../userGuide.js";import V from"./../popupWindow.js";window.askForLoginAlert=()=>window.messageAlert.addInfo("需要登入來使用此頁面","右上角登入按鈕登入",3e3),window.loadingElement=e('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new i(!1);{console.log("index.js Init"),window.messageAlert=new function(){const i=u("messageBox");function a(){r(this)}function n(e,t,o,n,s){const l=u(e,{onclick:a},p(t,"title"),p(o,"description",n),u("closeButton"));void 0!==s&&(l.removeTimeout=setTimeout(()=>r(l),s)),0<i.childElementCount?i.insertBefore(l,i.firstElementChild):i.appendChild(l),l.style.marginTop=-l.offsetHeight+"px",setTimeout(()=>{l.classList.add("animation"),l.style.marginTop="0"},10)}function r(e){e.removeAnimationTimeout||(clearTimeout(e.removeTimeout),e.style.opacity="0",e.style.marginTop=-e.offsetHeight-10+"px",e.removeAnimationTimeout=setTimeout(()=>{i.removeChild(e)},500))}this.element=i,this.addInfo=function(e,t,o){n("info",e,t,null,o)},this.addError=function(e,t,o){n("error",e,t,null,o)},this.addErrorElement=function(e,t,o){n("error",e,null,t,o)},this.addSuccess=function(e,t,o){n("success",e,t,null,o)},this.addSuccessElement=function(e,t,o){n("success",e,null,t,o)}},window.requestState=new function(){const t=this.element=u("stateBox noSelect");this.addState=function(e){return t.appendChild(u(null,window.loadingElement.cloneNode(!0),c(e,"title")))},this.removeState=function(e){t.removeChild(e)}};const L=M("https://fonts.googleapis.com/css2?family=Noto+Sans+TC&display=swap");document.requestStorageAccess&&document.requestStorageAccess().then(()=>console.log("StorageAccess granted"),()=>console.log("StorageAccess denied"));var b=$||window.localStorage&&!!localStorage.getItem("debug");let e=null;if(b){function v(e){return e.toString().padStart(2,"0")}console.log("Debug enabled"),P();var S=new Date;if(console.log(`${S.getFullYear()}-${v(S.getMonth()+1)}-${v(S.getDate())}T${v(S.getHours())}:${v(S.getMinutes())}:`+v(S.getSeconds())+(0<(S=S.getTimezoneOffset())?"-"+v(S/60|0)+":"+v(S%60):"+"+v(-S/60|0)+":"+v(-S%60))),window.performance&&window.performance.memory){const N=new i(window.performance.memory);setInterval(()=>N.set(window.performance.memory),1e3),e=p(a(N,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");const T=new V({small:!0,padding:!1});var S=new Y,y={Home:"成功大學課程資訊及選課系統",CourseSearch:"課程查詢",Schedule:"我的課表",GradeInquiry:"成績查詢",CourseSelectionPreference:"志願排序",UsefulWebsite:"實用網站",Profile:"使用者資料"};const A=new i,_=new i(!1),D=new R("NCKU++",y,"Home",{Home:new s("./res/minjs_v000/home.min.js"),CourseSearch:new s("./res/pages/courseSearch.js",A,S),Schedule:new s("./res/pages/courseSchedule.js",A),GradeInquiry:new s("./res/pages/stuIdSysGrades.js",A),CourseSelectionPreference:new s("./res/pages/preferenceAdjust.js",A),UsefulWebsite:new s("./res/pages/usefulWebsite.js",A),Profile:new s("./res/pages/profile.js",A)},B(u("borderLine"),u("source",d("資料來源"),t(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},n("res/assets/NCKU_course_system_logo.png","國立成功大學課程資訊及選課系統","noDrag")),t(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},n("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),t(null,"https://urschool.org/","noSelect",null,{target:"_blank"},n("res/assets/UrSchool_logo.png","UrSchool","noDrag")),u("splitLine")),o("By WavJaby"),o("Email: WavJaby@gmail.com"),t(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},n("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),p("GitHub repo")))),j=(S.setRouter(D),enableGoogleAnalytics(b),{});for(const G of["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"])j[G]=m(null,t(y[G],"./?page="+G,null,C,{pageId:G}));D.onPageOpen=function(e,t){"GradeInquiry"!==t&&"GradeInquiry"!==e&&A.state||h("/login?mode="+E(t),"Check login").then(I);var o=j[e],e=(e&&o&&o.classList.remove("opened"),j[t]);e&&e.classList.add("opened"),z(J.TITLE,document.title)};const H=u("navBarMobileBG",{onclick:k}),x=f("links",Object.values(j),m(null,function(e,t,o,n,s){const l=f(null),i=f(e?"list "+e:"list",n?{onmouseleave:u,onmouseenter:r}:null,m("items",l),m("title",t,{onclick:function(){s&&!s()&&!i.style.height||(i.style.height?u:r)()}}));for(const d of o){var a=d[1];l.appendChild(m(null,w(d[0]),{onItemClick:a,onclick:u}))}function r(){i.style.height=i.firstElementChild.offsetHeight+i.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function u(){this&&this.onItemClick&&this.onItemClick(),i.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let t=e.target;do{if(t===i)return}while((t=t.parentElement)!==document.body);u()}return i}("arrow",w("0w0"),[["嗨嗨",null],["🥰",null]]))),W=K("navbar noSelect",r("hamburgerMenu",null,function(){H.classList.toggle("open"),x.classList.toggle("open")},n("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect")),t(null,"./?page=Home","homePage",C,{pageId:"Home"},n("./res/assets/page_home/logo_text.svg","NCKU"),n("./res/assets/page_home/logo_plusplus_text.svg","++")),H,x,r("loginBtn",null,()=>(k(),A.state&&A.state.login?(h("/logout").then(I),!0):(_.set(!_.state),!1)),n("./res/assets/login_icon.svg",""),p(a(A,e=>e&&e.login?e.studentID:"登入"))));function k(){H.classList.remove("open"),x.classList.remove("open")}window.navMenuClose=k,D.element.addEventListener("scroll",()=>{0===D.element.scrollTop?W.classList.remove("scroll"):W.classList.add("scroll")});const X=u("root",W,D.element,S.element,l(_,function(t,o){const n=g("loginField","學號",null,{type:"text",autocomplete:"username"}),s=(n.value=localStorage.getItem("studentId")||"",g("loginField","密碼",null,{type:"password",autocomplete:"current-password"})),l=q("loginDeclaration","true"===localStorage.getItem("loginDeclaration"),function(){localStorage.setItem("loginDeclaration",this.checked)},p("我已閱讀"),r(null,"登入聲明",function(){T.isEmpty()&&T.windowSet(u("loginDeclarationWindow",c("聲明"),O(null,"declaration",p("本網站不會將密碼以任何形式暫存或儲存","red"),w("，登入功能僅代替使用者將資料轉至成功入口，並回傳登入狀態(Session Cookie)。\n"),p("本網站僅儲存學號以及登入狀態(Session Cookie)，提供附加功能之登入驗證使用","red"),w("。\n\n成功大學並未公開驗證系統的api，將來會嘗試爭取成功入口驗證系統作為本網站之登入方式。\n如果還會擔心請在使用完畢後登出，且不需登入也可以使用查詢功能。\n本網站開源，如對以上聲明有疑慮，請自行將專案下載後執行。"))));T.windowOpen()},{type:"button"}));let i=!1;const a=F("loginWindow",function(e){e.preventDefault(),i||(l.input.checked?(i=!0,window.pageLoading.set(!0),e=n.value.endsWith("@ncku.edu.tw")?n:n.value+"@ncku.edu.tw",h("/login?mode="+E(D.getCurrentPage()),"login",{method:"POST",body:JSON.stringify({username:e,password:s.value}),timeout:1e4}).then(e=>{i=!1,window.pageLoading.set(!1),e.success&&e.data.login&&localStorage.setItem("studentId",n.value),t(e)})):messageAlert.addError("請先閱讀登入聲明","",2e3))},{onRender:()=>{window.addEventListener("click",e),n.focus()},onDestroy:()=>window.removeEventListener("click",e)},d("登入"),n,s,p("帳密與成功入口相同","description"),u("bottomRow",l,r("loginField","登入",null,{type:"submit"})));return a;function e(e){let t=e.target;for(;t.parentElement;){if(t===a||t===window.messageAlert.element||"loginBtn"===t.className||t.className.startsWith("popupWindow"))return;if(t===document.body)break;t=t.parentElement}o.set(!1)}}(I,_)),l(window.pageLoading,u("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,window.requestState.element,e);function C(e){e.preventDefault();e=this.pageId;return D.openPage(e),k(),!1}function I(e){var t;e?(t=e.data)?!t.login&&e.msg?window.messageAlert.addError("Login failed",e.msg,5e3):(A.set(t),t.login&&_.set(!1)):window.messageAlert.addError("Unknown login error","Try again later",3e3):window.messageAlert.addError("Network error","Try again later",3e3)}function E(e){return"GradeInquiry"===e?"stuId":"course"}window.onload=()=>{for(console.log("Window onload"),L.mount();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(X),D.initFirstPage(),Q()&&window.messageAlert.addInfo("可使用電腦來獲得最佳體驗","手機版具完整功能，但介面正在調整中，請見諒",1e4),document.location.host.startsWith("wavjaby.github.io")&&window.messageAlert.addErrorElement("主要伺服器目前不穩定",u(null,p("主要伺服器目前不穩定，請使用備用伺服器。(歉🥹"),U(),t(" 點我進入備用伺服器","https://37a2-2001-b400-e285-37e9-b913-f26-1403-da61.ngrok-free.app/NCKUpp/")),1e5)}}
//# sourceMappingURL=index.min.js.map