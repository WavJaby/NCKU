"use strict";import{a as o,button as i,div as u,doomHelperDebug as B,footer as G,h1 as r,h2 as F,h3 as n,img as t,input as a,li as g,mountableStylesheet as N,nav as q,p as M,QueryRouter as R,RouterLazyLoad as s,ShowIf as l,Signal as c,span as d,svg as e,text as m,TextState as p,ul as w}from"./domHelper.min.js";import{metaSet as $,metaType as z}from"./../lib/metaTag.js";import{fetchApi as f,isLocalNetwork as J}from"./../lib/lib.js";import{UserGuideTool as K}from"./../userGuide.js";import O from"./../popupWindow.js";window.askForLoginAlert=()=>window.messageAlert.addInfo("需要登入來使用此頁面","右上角登入按鈕登入",3e3),window.loadingElement=e('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new c(!1);{console.log("index.js Init"),window.messageAlert=new function(){const i=u("messageBox");function r(){a(this)}function t(e,o,n,t,s){const l=u(e,{onclick:r},d(o,"title"),d(n,"description",t),u("closeButton"));void 0!==s&&(l.removeTimeout=setTimeout(()=>a(l),s)),0<i.childElementCount?i.insertBefore(l,i.firstElementChild):i.appendChild(l),l.style.marginTop=-l.offsetHeight+"px",setTimeout(()=>{l.classList.add("animation"),l.style.marginTop="0"},10)}function a(e){e.removeAnimationTimeout||(clearTimeout(e.removeTimeout),e.style.opacity="0",e.style.marginTop=-e.offsetHeight-10+"px",e.removeAnimationTimeout=setTimeout(()=>{i.removeChild(e)},500))}this.element=i,this.addInfo=function(e,o,n){t("info",e,o,null,n)},this.addError=function(e,o,n){t("error",e,o,null,n)},this.addErrorElement=function(e,o,n){t("error",e,null,o,n)},this.addSuccess=function(e,o,n){t("success",e,o,null,n)},this.addSuccessElement=function(e,o,n){t("success",e,null,o,n)}},window.requestState=new function(){const o=this.element=u("stateBox noSelect");this.addState=function(e){return o.appendChild(u(null,window.loadingElement.cloneNode(!0),r(e,"title")))},this.removeState=function(e){o.removeChild(e)}};const T=N("https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap");document.requestStorageAccess&&document.requestStorageAccess().then(()=>console.log("StorageAccess granted"),()=>console.log("StorageAccess denied"));var h=J||window.localStorage&&!!localStorage.getItem("debug");let e=null;if(h){function b(e){return e.toString().padStart(2,"0")}console.log("Debug enabled"),B();var S=new Date;if(console.log(`${S.getFullYear()}-${b(S.getMonth()+1)}-${b(S.getDate())}T${b(S.getHours())}:${b(S.getMinutes())}:`+b(S.getSeconds())+(0<(S=S.getTimezoneOffset())?"-"+b(S/60|0)+":"+b(S%60):"+"+b(-S/60|0)+":"+b(-S%60))),window.performance&&window.performance.memory){const x=new c(window.performance.memory);setInterval(()=>x.set(window.performance.memory),1e3),e=d(p(x,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");const E=new O;var S=new K,y={Home:"成功大學課程資訊及選課系統",CourseSearch:"課程查詢",Schedule:"課表",GradeInquiry:"成績查詢",CourseSelectionPreference:"志願排序",UsefulWebsite:"實用網站",Profile:"使用者資料"};const I=new c,H=new c(!1),j=new R("NCKU++",y,"Home",{Home:new s("./res/minjs_v000/home.min.js"),CourseSearch:new s("./res/pages/courseSearch.js",I,S),Schedule:new s("./res/pages/courseSchedule.js",I),GradeInquiry:new s("./res/pages/stuIdSysGrades.js",I),CourseSelectionPreference:new s("./res/pages/preferenceAdjust.js",I),UsefulWebsite:new s("./res/pages/usefulWebsite.js",I),Profile:new s("./res/pages/profile.js",I)},G(u("borderLine"),u("source",F("資料來源"),o(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},t("res/assets/NCKU_course_system_logo.png","國立成功大學課程資訊及選課系統","noDrag")),o(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},t("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),o(null,"https://urschool.org/","noSelect",null,{target:"_blank"},t("res/assets/UrSchool_logo.png","UrSchool","noDrag")),u("splitLine")),n("By WavJaby"),n("Email: WavJaby@gmail.com"),o(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},t("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),d("GitHub repo")))),A=(S.setRouter(j),enableGoogleAnalytics(h),{});for(const W of["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"])A[W]=g(null,o(y[W],"./?page="+W,null,C,{pageId:W}));j.onPageOpen=function(e,o){var n=A[e],e=(e&&n&&n.classList.remove("opened"),A[o]);e&&e.classList.add("opened"),$(z.TITLE,document.title)};const D=w("navBarMobileBG",{onclick:v}),U=w("links",Object.values(A),g(null,L("arrow",m("0w0"),[["嗨嗨",null],["🥰",null]]))),P=q("navbar noSelect",L("loginBtn",d(p(I,e=>e&&e.login?e.studentID:"登入")),[["Profile",()=>j.openPage("Profile")],["Logout",()=>f("/logout").then(k)]],!1,()=>(v(),I.state&&I.state.login?!0:(H.set(!H.state),!1))),w("hamburgerMenu",g(null,t("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect",{onclick:function(){D.classList.toggle("open"),U.classList.toggle("open")}}))),w("homePage",g(null,o("NCKU++","./?page=Home",null,C,{pageId:"Home"}))),D,U);function v(){D.classList.remove("open"),U.classList.remove("open")}window.navMenuClose=v,j.element.addEventListener("scroll",()=>{0===j.element.scrollTop?P.classList.remove("scroll"):P.classList.add("scroll")}),f("/login?mode=course","Check login").then(k);const _=u("root",P,j.element,S.element,l(H,function(o){const n=a("loginField","學號",null,{onkeyup:e,type:"email",autocomplete:"username"}),t=a("loginField","密碼",null,{onkeyup:e,type:"password",autocomplete:"current-password"});let s=!1;function e(e){"Enter"===e.key&&l()}function l(){var e;s||(s=!0,window.pageLoading.set(!0),e=n.value.endsWith("@ncku.edu.tw")?n:n.value+"@ncku.edu.tw",f("/login?mode=course","login",{method:"POST",body:`username=${encodeURIComponent(e)}&password=`+encodeURIComponent(t.value),timeout:1e4}).then(e=>{s=!1,window.pageLoading.set(!1),o(e)}))}return u("loginWindow",{onRender:()=>n.focus()},i("loginFunctionDeclaration","登入功能聲明",function(){E.isEmpty()&&E.windowSet(u("loginFunctionDeclarationWindow",r("聲明: "),M(null,"declaration",d("本網站不會將密碼以任何形式暫存或儲存","red"),m("，登入功能僅代替使用者將資料轉至成功入口，並回傳登入狀態(Session Cookie)\n"),d("本網站僅儲存學號以及登入狀態(Session Cookie)，提供附加功能之登入驗證使用\n","red"),m("這是不得已的，成大不像其他學校，成大並未公開auth驗證系統的api，如果會擔心的使用者可在使用完畢後登出，且不登入也可以使用查詢功能\n將來會嘗試爭取成功入口驗證系統之api，作為本網站之登入方式\n本網站開源，如對以上聲明還是有疑慮，請自行將專案下載後執行")))),E.windowOpen()}),n,t,d("帳密與成功入口相同","description"),i("loginField","登入",l,{type:"submit"}))}(k)),l(window.pageLoading,u("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,window.requestState.element,e);function C(e){e.preventDefault();e=this.pageId;return j.openPage(e),v(),!1}function k(e){var o;e?(o=e.data)?!o.login&&e.msg?window.messageAlert.addError("Login failed",e.msg,5e3):(I.set(o),H.set(!1)):window.messageAlert.addError("Unknown login error","Try again later",3e3):window.messageAlert.addError("Network error","Try again later",3e3)}function L(e,o,n,t,s){var l=w(null);const i=w(e?"list "+e:"list",t?{onmouseleave:u,onmouseenter:a}:null,g("items",l),g("title",o,{onclick:function(){s&&!s()&&!i.style.height||(i.style.height?u:a)()}}));for(const d of n){var r=d[1];l.appendChild(g(null,m(d[0]),{onItemClick:r,onclick:u}))}function a(){i.style.height=i.firstElementChild.offsetHeight+i.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function u(){this&&this.onItemClick&&this.onItemClick(),i.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let o=e.target;do{if(o===i)return}while((o=o.parentElement)!==document.body);u()}return i}window.onload=()=>{for(console.log("Window onload"),T.mount();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(_),j.initFirstPage()}}
//# sourceMappingURL=index.min.js.map