"use strict";import{a as e,button as o,div as n,doomHelperDebug as t,footer as s,h1 as i,h2 as l,h3 as r,img as a,input as c,li as u,mountableStylesheet as d,nav as g,QueryRouter as m,RouterLazyLoad as p,ShowIf as f,Signal as w,span as h,svg as b,text as y,TextState as S,ul as v}from"./res/lib/domHelper_v003.min.js";import{metaSet as C,metaType as k}from"./res/lib/metaTag.js";import{fetchApi as L,isLocalNetwork as E}from"./res/lib/lib.js";import{UserGuideTool as I}from"./res/userGuide.js";window.askForLoginAlert=(()=>window.messageAlert.addInfo("需要登入來使用此頁面","右上角登入按鈕登入",3e3)),window.loadingElement=b('<circle class="path" cx="25" cy="25" r="20" fill="none" stroke-width="5" stroke-linecap="square"/>',"0 0 50 50","loaderCircle"),window.pageLoading=new w(!1),function(){console.log("index.js Init"),window.messageAlert=new function(){const e=n("messageBox");function o(){s(this)}function t(t,i,l,r,a){const c=n(t,{onclick:o},h(i,"title"),h(l,"description",r),n("closeButton"));void 0!==a&&(c.removeTimeout=setTimeout(()=>s(c),a)),e.childElementCount>0?e.insertBefore(c,e.firstElementChild):e.appendChild(c),c.style.marginTop=-c.offsetHeight+"px",setTimeout(()=>{c.classList.add("animation"),c.style.marginTop="0"},10)}function s(o){o.removeAnimationTimeout||(clearTimeout(o.removeTimeout),o.style.opacity="0",o.style.marginTop=-o.offsetHeight-10+"px",o.removeAnimationTimeout=setTimeout(()=>{e.removeChild(o)},500))}this.element=e,this.addInfo=function(e,o,n){t("info",e,o,null,n)},this.addError=function(e,o,n){t("error",e,o,null,n)},this.addErrorElement=function(e,o,n){t("error",e,null,o,n)},this.addSuccess=function(e,o,n){t("success",e,o,null,n)},this.addSuccessElement=function(e,o,n){t("success",e,null,o,n)}},window.requestState=new function(){const e=this.element=n("stateBox noSelect");this.addState=function(o){return e.appendChild(n(null,window.loadingElement.cloneNode(!0),i(o,"title")))},this.removeState=function(o){e.removeChild(o)}};const b=d("https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap");document.requestStorageAccess&&document.requestStorageAccess().then(()=>console.log("StorageAccess granted"),()=>console.log("StorageAccess denied"));const T=E||window.localStorage&&!!localStorage.getItem("debug");let A=null;if(T){if(console.log("Debug enabled"),t(),window.performance&&window.performance.memory){const e=new w(window.performance.memory);setInterval(()=>e.set(window.performance.memory),1e3),A=h(S(e,e=>(e.usedJSHeapSize/1e3/1e3).toFixed(2)+"MB"),null,{style:"position: absolute; top: 0; z-index: 100; background: black; font-size: 10px; opacity: 0.5;"})}}else console.log("Debug disable");const H=new I,j={Home:"成功大學課程資訊及選課系統",CourseSearch:"課程查詢",Schedule:"課表",GradeInquiry:"成績查詢",CourseSelectionPreference:"志願排序",UsefulWebsite:"實用網站",Profile:"使用者資料"},P=["CourseSearch","Schedule","GradeInquiry","CourseSelectionPreference","UsefulWebsite"],_=new w,U=new w(!1),x=new m("NCKU++",j,"Home",{Home:new p("./res/pages/home_v003.min.js"),CourseSearch:new p("./res/pages/courseSearch.js",_,H),Schedule:new p("./res/pages/courseSchedule.js",_),GradeInquiry:new p("./res/pages/stuIdSysGrades.js",_),CourseSelectionPreference:new p("./res/pages/preferenceAdjust.js",_),UsefulWebsite:new p("./res/pages/usefulWebsite.js",_),Profile:new p("./res/pages/profile.js",_)},s(n("borderLine"),n("source",l("資料來源"),e(null,"https://course.ncku.edu.tw/","noSelect",null,{target:"_blank"},a("res/assets/NCKU_course_system_logo.png","國立成功大學課程資訊及選課系統","noDrag")),e(null,"https://nckuhub.com/","noSelect",null,{target:"_blank"},a("res/assets/nckuHub_logo.svg","NCKUHub","noDrag")),e(null,"https://urschool.org/","noSelect",null,{target:"_blank"},a("res/assets/UrSchool_logo.png","UrSchool","noDrag")),n("splitLine")),r("By WavJaby"),r("Email: WavJaby@gmail.com"),e(null,"https://github.com/WavJaby/NCKUpp","openRepo noSelect",null,{target:"_blank"},a("./res/assets/github_icon.svg","GitHub icon","githubIcon noDrag"),h("GitHub repo"))));H.setRouter(x),enableGoogleAnalytics(T);const B={};for(const o of P)B[o]=u(null,e(j[o],"./?page="+o,null,N,{pageId:o}));x.onPageOpen=function(e,o){const n=B[e];e&&n&&n.classList.remove("opened");const t=B[o];t&&t.classList.add("opened"),C(k.TITLE,document.title)};const W=v("links",Object.values(B),u(null,J("arrow",y("0w0"),[["嗨嗨",null],["🥰",null]]))),D=v("navBarMobileBG",{onclick:G});function G(){W.classList.remove("open"),D.classList.remove("open")}window.navMenuClose=G,L("/login?mode=course","Check login").then(F);const q=n("root",g("navbar noSelect",J("loginBtn",h(S(_,e=>e&&e.login?e.studentID:"Login")),[["Profile",()=>x.openPage("Profile")],["Logout",()=>L("/logout").then(F)]],!1,()=>(G(),!(!_.state||!_.state.login)||(U.set(!U.state),!1))),v("hamburgerMenu",u(null,a("./res/assets/burger_menu_icon.svg","mobile menu button","noDrag noSelect",{onclick:function(){W.classList.toggle("open"),D.classList.toggle("open")}}))),v("homePage",u(null,e("NCKU++","./?page=Home",null,N,{pageId:"Home"}))),D,W),x.element,H.element,f(U,function(e){const t=c("loginField","Account",null,{onkeyup:l,type:"email",autocomplete:"username"}),s=c("loginField","Password",null,{onkeyup:l,type:"password",autocomplete:"current-password"});let i=!1;function l(e){"Enter"===e.key&&r()}function r(){if(!i){i=!0,window.pageLoading.set(!0);const o=t.value.endsWith("@ncku.edu.tw")?t:t.value+"@ncku.edu.tw";L("/login?mode=course","login",{method:"POST",body:`username=${encodeURIComponent(o)}&password=${encodeURIComponent(s.value)}`,timeout:1e4}).then(o=>{i=!1,window.pageLoading.set(!1),e(o)})}}return n("loginWindow",{onRender:()=>t.focus()},h("帳密與成功入口相同","description"),t,s,o("loginField","Login",r,{type:"submit"}))}(F)),f(window.pageLoading,n("loading",window.loadingElement.cloneNode(!0))),window.messageAlert.element,window.requestState.element,A);function N(e){e.preventDefault();const o=this.pageId;return x.openPage(o),G(),!1}function F(e){if(!e)return void window.messageAlert.addError("Network error","Try again later",3e3);const o=e.data;o?o.login||!e.msg?(_.set(o),U.set(!1)):window.messageAlert.addError("Login failed",e.msg,5e3):window.messageAlert.addError("Unknown login error","Try again later",3e3)}function J(e,o,n,t,s){const i=v(null),l=v(e?"list "+e:"list",t?{onmouseleave:a,onmouseenter:r}:null,u("items",i),u("title",o,{onclick:function(){if(s&&!s()&&!l.style.height)return;l.style.height?a():r()}}));for(const e of n){const o=e[1];i.appendChild(u(null,y(e[0]),{onItemClick:o,onclick:a}))}function r(){l.style.height=l.firstElementChild.offsetHeight+l.lastElementChild.offsetHeight+"px",window.addEventListener("pointerup",c)}function a(){this&&this.onItemClick&&this.onItemClick(),l.style.height=null,window.removeEventListener("pointerup",c)}function c(e){let o=e.target;do{if(o===l)return}while((o=o.parentElement)!==document.body);a()}return l}window.onload=(()=>{for(console.log("Window onload"),b.mount();document.body.firstChild;)document.body.removeChild(document.body.firstChild);document.body.appendChild(q),x.initFirstPage()})}();